<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>Yaki Menu</title>

    <style>
        .card.ordered-flag {
            border: 2px solid red;
            box-shadow: 0 0 12px rgba(255, 0, 0, 0.5);
        }


        #orderedPanel {
            position: fixed;
            top: 0;
            right: 0;
            width: 360px;
            height: 100vh;
            background: rgba(25, 25, 25, 0.7);
            backdrop-filter: blur(30px);
            padding: 22px;
            border-left: 2px solid rgba(255, 200, 100, 0.5);
            overflow-y: auto;
            z-index: 998;
            transform: translateX(100%);
            transition: 0.35s ease;
        }

        #orderedPanel.show {
            transform: translateX(0);
        }


        #customAlertOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.55);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(3px);
        }

        #customAlertBox {
            background: #1f1f1f;
            padding: 28px 30px;
            border-radius: 14px;
            width: 330px;
            text-align: center;
            color: #fff;
            border: 1.5px solid rgba(255, 100, 100, 0.35);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.45);
            animation: alertPop 0.35s ease forwards;
            opacity: 0;
            transform: scale(0.7);
        }

        @keyframes alertPop {
            0% {
                opacity: 0;
                transform: scale(0.7);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* ===== CUSTOM CONFIRM ===== */
        #customConfirmOverlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.55);
            backdrop-filter: blur(3px);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2001;
        }

        #customConfirmBox {
            background: #1f1f1f;
            padding: 28px 30px;
            border-radius: 14px;
            width: 350px;
            text-align: center;
            color: #fff;
            border: 1.5px solid rgba(255, 100, 100, 0.35);
            box-shadow: 0 12px 35px rgba(0, 0, 0, 0.45);
            animation: alertPop 0.35s ease forwards;
            opacity: 0;
            transform: scale(0.7);
        }

        .confirm-buttons {
            margin-top: 20px;
            display: flex;
            justify-content: space-between;
            gap: 12px;
        }

        .confirm-btn {
            flex: 1;
            padding: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.25s;
        }

        #confirmCancelBtn {
            background: rgba(255, 255, 255, 0.1);
        }

        #confirmCancelBtn:hover {
            transform: scale(1.05);
        }

        #confirmOkBtn {
            background: linear-gradient(45deg, #ff4d4d, #ffa64d);
            color: #fff;
        }

        #confirmOkBtn:hover {
            transform: scale(1.07);
        }



        #alertOkBtn {
            margin-top: 20px;
            padding: 10px 22px;
            background: linear-gradient(45deg, #ff4d4d, #ffa64d);
            border-radius: 10px;
            cursor: pointer;
            display: inline-block;
            color: #fff;
            font-weight: bold;
            transition: 0.25s;
        }

        #alertOkBtn:hover {
            transform: scale(1.06);
        }



        /*===================Th√πng r√°C=================================*/

        .cart-clear-btn {
            font-size: 22px;
            color: #ff0000;
            cursor: pointer;
            margin-right: 14px;
        }

        .cart-item-delete {
            font-size: 18px;
            color: #bbbbbb;
            cursor: pointer;
            margin-left: 10px;
        }

        .cart-item-delete:hover {
            color: #ff5b5b;
        }




        /*=========================√î s·ªë l∆∞·ª£ng trong gi·ªè h√†ng===================*/
        .cartQtyInput {
            width: 50px;
            padding: 6px;
            margin-left: 6px;
            margin-right: 6px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #888;
            border-radius: 6px;
            color: #fff;
            text-align: center;
        }


        /* ======================= GLOBAL ======================= */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: radial-gradient(circle at 20% 30%, #1b1b1b, #0c0c0c 70%);
            color: #fff;
            overflow-x: hidden;
        }

        /* ======================= HEADER ======================= */
        header {
            padding: 18px 22px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(20, 20, 20, 0.7);
            backdrop-filter: blur(20px);
            border-bottom: 1.5px solid rgba(255, 77, 77, 0.4);
        }

        .logo {
            font-size: 26px;
            font-weight: bold;
            background: linear-gradient(90deg, #ff4d4d, #ff914d);
            -webkit-background-clip: text;
            color: transparent;
        }

        .header-controls {
            display: flex;
            gap: 10px;
        }

        select,
        button {
            padding: 8px 12px;
            border-radius: 10px;
            background: rgba(40, 40, 40, 0.6);
            color: #fff;
            border: 1px solid rgba(90, 90, 90, 0.5);
        }

        /* Mobile Header */
        @media (max-width: 600px) {
            header {
                flex-direction: column;
                gap: 10px;
            }

            .header-controls {
                flex-wrap: wrap;
                justify-content: center;
            }
        }

        /* ======================= TABS ======================= */
        .tabs {
            display: flex;
            overflow-x: auto;
            gap: 22px;
            padding: 12px 20px;
        }

        .tabs::-webkit-scrollbar {
            display: none;
        }

        .tab {
            padding: 12px 22px;
            color: #ccc;
            cursor: pointer;
            white-space: nowrap;
            transition: transform 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.05);
        }

        .tab:hover {
            transform: translateY(-6px) scale(1.05);
            color: #ff7b7b;
            box-shadow: 0 10px 25px rgba(255, 77, 77, 0.35);
            background: rgba(255, 77, 77, 0.08);
        }

        .tab.active {
            color: #ff7b7b;
            border-bottom: 2px solid #ff7b7b;
            background: rgba(255, 77, 77, 0.1);
        }


        /* ======================= MENU GRID ======================= */
        .container {
            padding: 25px;
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 26px;
        }

        @media (max-width: 1100px) {
            .container {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 800px) {
            .container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 550px) {
            .container {
                grid-template-columns: repeat(1, 1fr);
            }
        }

        /* ======================= CARD (UPGRADED) ======================= */
        .card {
            position: relative;
            background: rgba(255, 255, 255, 0.06);
            border-radius: 20px;
            overflow: hidden;
            backdrop-filter: blur(18px);
            border: 1px solid rgba(255, 255, 255, 0.12);
            box-shadow: 0px 6px 18px rgba(0, 0, 0, 0.35);
            transition: transform .25s ease, box-shadow .25s ease;
            padding: 16px;
            /* kho·∫£ng c√°ch b√™n trong card */
        }

        .card:hover {
            transform: translateY(-6px) scale(1.015);
            box-shadow: 0 12px 28px rgba(255, 60, 60, 0.35);
        }


        .card img {
            width: 100%;
            height: 190px;
            object-fit: cover;
            transition: transform .35s ease;
        }

        /* Zoom ·∫£nh nh·∫π khi hover */
        .card:hover img {
            transform: scale(1.07);
        }


        .qty-row {
            margin-top: 14px;
            display: flex;
            align-items: center;
        }

        .qty-btn {
            width: 34px;
            height: 34px;
            background: rgba(80, 80, 80, 0.5);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
        }

        .add-cart-btn {
            margin-left: auto;
            background: linear-gradient(45deg, #ff4d4d, #ffa04d);
            padding: 8px 18px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
        }


        /* Card ƒë∆∞·ª£c ch·ªçn (ƒë√£ c√≥ trong gi·ªè) */
        .card.selected {
            border: 2px solid #4ade80;
            /* xanh l√° */
            box-shadow: 0 0 12px rgba(74, 222, 128, 0.6);
            position: relative;
        }

        /* Icon tick */
        .card .tick-mark {
            position: absolute;
            top: 10px;
            right: 10px;
            background: #4ade80;
            color: #000;
            width: 26px;
            height: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 0 6px rgba(0, 0, 0, 0.4);
        }



        /* ======================= CART PANEL ======================= */
        #cartPanel {
            position: fixed;
            top: 0;
            right: 0;
            width: 360px;
            max-width: 100%;
            height: 100vh;
            background: rgba(25, 25, 25, 0.7);
            backdrop-filter: blur(30px);
            padding: 22px;
            border-left: 2px solid rgba(255, 120, 120, 0.5);
            overflow-y: auto;
            z-index: 999;
            transform: translateX(100%);
            transition: transform 0.35s ease;
        }

        #cartPanel.show {
            transform: translateX(0);
        }

        .close-cart {
            font-size: 28px;
            color: #ff8080;
            cursor: pointer;
            text-align: right;
        }

        .cart-item {
            padding: 14px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
        }

        #orderBtn {
            width: 100%;
            margin-top: 18px;
            padding: 13px;
            background: linear-gradient(45deg, #ff4d4d, #ff9f4d);
            border-radius: 12px;
            font-weight: bold;
            text-align: center;
            cursor: pointer;
        }

        /* ======================= SHAKE ======================= */
        @keyframes shake {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }


        .qty-input {
            width: 55px;
            padding: 6px 8px;
            text-align: center;
            background: rgba(80, 80, 80, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 16px;

            /* Lo·∫°i b·ªè m≈©i t√™n tƒÉng/gi·∫£m */
            -moz-appearance: textfield;
        }

        .qty-input::-webkit-inner-spin-button,
        .qty-input::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }


        .qty-input::-webkit-inner-spin-button,
        .qty-input::-webkit-outer-spin-button {
            opacity: 1;
        }
    </style>
</head>


<body>

    <header>
        <div class="logo">üî• Yaki</div>

        <div class="header-controls">
            <select id="langSelect">
                <option>Ti·∫øng Vi·ªát</option>
                <option>English</option>
                <option>‰∏≠Êñá</option>
                <option>Êó•Êú¨Ë™û</option>
                <option>ÌïúÍµ≠Ïñ¥</option>
            </select>

            <span id="tableDisplay"
                style="padding: 8px 12px; border-radius: 10px; background: rgba(40, 40, 40, 0.6); color: #fff; border: 1px solid rgba(90, 90, 90, 0.5);">B√†n
                1</span>

            <button onclick="toggleCart()">üõí
                <span id="cartBtnText">Gi·ªè</span>
                (<span id="cartCount">0</span>)
            </button>

            <button onclick="toggleOrdered()">üîî
                <span id="orderedText">ƒê√£ g·ªçi</span>
                (<span id="orderedCount">0</span>)
            </button>

        </div>
    </header>

    <!-- TABS -->
    <div class="tabs">

        <div class="tab active" onclick="changeTab('nuong', event)">M√≥n N∆∞·ªõng</div>
        <div class="tab" onclick="changeTab('lau', event)">L·∫©u</div>
        <div class="tab" onclick="changeTab('mon_phu', event)">M√≥n Ph·ª•</div>
        <div class="tab" onclick="changeTab('nuoc', event)">ƒê·ªì U·ªëng</div>



    </div>

    <!-- MENU -->
    <div id="menuList" class="container"></div>

    <!-- CART -->
    <div id="cartPanel">
        <div style="display:flex; justify-content: space-between; align-items:center;">
            <div class="cart-clear-btn" onclick="clearCart()">üóëÔ∏è</div>
            <div class="close-cart" onclick="toggleCart()">‚úñ</div>
        </div>

        <h2 id="cartTitle">Gi·ªè h√†ng</h2>
        <div id="cartItems"></div>
        <h3 style="margin-top:20px">
            <span id="totalLabel">T·ªïng</span>:
            <span id="totalPrice">0</span> ƒë
        </h3>
        <div id="orderBtn" onclick="placeOrder()">X√°c nh·∫≠n ƒë·∫∑t m√≥n</div>
    </div>

    <div id="orderedPanel">
        <div class="close-cart" onclick="toggleOrdered()">‚úñ</div>

        <h2 id="orderedTitle">M√≥n ƒë√£ g·ªçi</h2>
        <div id="orderedItems"></div>

        <h3 style="margin-top:20px">
            <span id="orderedTotalLabel">T·ªïng</span>: <span id="orderedTotal">0</span> ƒë
        </h3>
    </div>


    <script>

        /* ======================= FIREBASE SETUP ======================= */
        // Firebase SDKs
    </script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>

        const firebaseConfig = {
            apiKey: "AIzaSyCCTaXqidGM4DIyJnz1-zbg_6PdxmDpV30",
            authDomain: "food-order-at-table-to-kitchen.firebaseapp.com",
            projectId: "food-order-at-table-to-kitchen",
            storageBucket: "food-order-at-table-to-kitchen.firebasestorage.app",
            messagingSenderId: "179233667372",
            appId: "1:179233667372:web:76170af27a89ff778a9489"
        };

        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function renderOrderedItems() {
            const box = document.getElementById("orderedItems");
            box.innerHTML = "";

            let total = 0;

            for (let id in orderedItems) {
                const item = orderedItems[id];
                total += item.qty * item.price;

                box.innerHTML += `
            <div class="cart-item">
                <b>${item.name[currentLang]}</b><br>
                ${translations[currentLang].ordered.qty}: ${item.qty} √ó ${item.price.toLocaleString()} ƒë
            </div>
        `;
            }

            document.getElementById("orderedTotal").innerText = total.toLocaleString();
            document.getElementById("orderedCount").innerText =
                Object.values(orderedItems).reduce((a, b) => a + b.qty, 0);
        }


        /*=======================custom alert=========================*/
        function showAlert(msg) {
            const overlay = document.getElementById("customAlertOverlay");
            const box = document.getElementById("customAlertBox");

            document.getElementById("alertMessage").innerText = msg;

            overlay.style.display = "flex";

            // Reset animation ƒë·ªÉ ch·∫°y l·∫°i m∆∞·ª£t
            box.style.animation = "none";
            void box.offsetWidth; // trick restart animation
            box.style.animation = "alertPop 0.35s ease forwards";
        }

        function closeAlert() {
            const overlay = document.getElementById("customAlertOverlay");
            overlay.style.display = "none";
        }

        /* ======================= CUSTOM CONFIRM ======================= */
        let confirmCallback = null;

        function showConfirm(msg, callback) {
            confirmCallback = callback;

            // Hi·ªÉn th·ªã n·ªôi dung confirm
            document.getElementById("confirmMessage").innerText = msg;

            // C·∫≠p nh·∫≠t n√∫t theo ng√¥n ng·ªØ hi·ªán t·∫°i
            document.getElementById("confirmCancelBtn").innerText = translations[currentLang].confirm.cancel;
            document.getElementById("confirmOkBtn").innerText = translations[currentLang].confirm.ok;

            const overlay = document.getElementById("customConfirmOverlay");
            const box = document.getElementById("customConfirmBox");

            overlay.style.display = "flex";

            // Reset animation ƒë·ªÉ ch·∫°y l·∫°i m∆∞·ª£t
            box.style.animation = "none";
            void box.offsetWidth; // trick restart animation
            box.style.animation = "alertPop 0.35s ease forwards";
        }

        function closeConfirm(result) {
            // ·∫®n overlay
            document.getElementById("customConfirmOverlay").style.display = "none";

            // Ch·ªâ g·ªçi callback n·∫øu c√≥
            if (confirmCallback) confirmCallback(result);
        }

        /* ======================= CLEAR CART ======================= */
        function clearCart() {
            // Hi·ªÉn th·ªã confirm tr∆∞·ªõc khi x√≥a to√†n b·ªô gi·ªè h√†ng
            showConfirm(translations[currentLang].confirm.clearAll, function (ok) {

                if (!ok) return; // Nh·∫•n Cancel ‚Üí gi·ªØ nguy√™n tr·∫°ng th√°i

                // N·∫øu nh·∫•n OK ‚Üí x√≥a to√†n b·ªô
                for (let id in cart) {
                    cart[id].qty = 0;
                    cart[id].tempQty = 0;
                }

                updateCart();
                renderMenu();
            });
        }


        /*=======================x√≥a t·ª´ng m√≥n=========================*/

        function deleteItem(id) {
            cart[id].qty = 0;
            cart[id].tempQty = 0;

            updateCart();
            renderMenu();
        }


        /*=================x√≥a to√†n b·ªô gi·ªè h√†ng=======================*/

        function clearCart() {
            showConfirm(translations[currentLang].confirm.clearAll, function (ok) {

                if (!ok) return; // Nh·∫•n Cancel ‚Üí kh√¥ng l√†m g√¨

                // Nh·∫•n OK ‚Üí x√≥a to√†n b·ªô gi·ªè h√†ng
                for (let id in cart) {
                    cart[id].qty = 0;
                    cart[id].tempQty = 0;
                }

                updateCart();
                renderMenu();
            });
        }





        /*==================Ch·ª©c nƒÉng cho √¥ s·ªë l∆∞·ª£ng gi·ªè h√†ng========*/

        function changeCartQty(input) {
            const id = input.dataset.id;
            const oldQty = cart[id].qty;
            let newQty = input.value;

            // R·ªóng ‚Üí kh√¥ng c·∫≠p nh·∫≠t g√¨ (ƒë·ªÉ user nh·∫≠p ti·∫øp)
            if (newQty === "") return;

            newQty = Number(newQty);
            if (newQty < 0) newQty = 0;

            input.value = newQty;

            // N·∫øu = 0 ‚Üí x√≥a kh·ªèi gi·ªè
            if (newQty === 0) {
                cart[id].qty = 0;
                cart[id].tempQty = 0; // ƒë·ªìng b·ªô v·ªõi menu
                updateCart();
                renderMenu();         // c·∫≠p nh·∫≠t menu
                return;
            }

            // N·∫øu kh√°c s·ªë l∆∞·ª£ng c≈© ‚Üí c·∫≠p nh·∫≠t
            if (newQty !== oldQty) {
                cart[id].qty = newQty;
                cart[id].tempQty = newQty;  // b·∫Øt bu·ªôc ƒë·ªìng b·ªô menu
                updateCart();
                renderMenu();
            }
        }


        /* ======================= NG√îN NG·ªÆ ======================= */
        const translations = {
            vi: {
                tabs: { nuong: "M√≥n N∆∞·ªõng", lau: "L·∫©u", mon_phu: "M√≥n Ph·ª•", nuoc: "ƒê·ªì U·ªëng" },
                buttons: { add: "Th√™m", order: "X√°c nh·∫≠n ƒë·∫∑t m√≥n", cart: "Gi·ªè", ordered: "ƒê√£ g·ªçi" },
                messages: {
                    orderSent: "ƒê∆°n ƒë√£ g·ª≠i t·ªõi b·∫øp!",
                    emptyCart: "Gi·ªè h√†ng tr·ªëng!"
                },
                cart: { title: "Gi·ªè h√†ng", total: "T·ªïng", qty: "SL" },
                ordered: { title: "M√≥n ƒë√£ g·ªçi", total: "T·ªïng", qty: "SL" },
                table: "B√†n",
                confirm: {
                    clearAll: "X√≥a to√†n b·ªô gi·ªè h√†ng?",
                    cancel: "H·ªßy",
                    ok: "X√≥a"
                }

            },
            en: {
                tabs: { nuong: "Grilled", lau: "Hotpot", mon_phu: "Side Dishes", nuoc: "Drinks" },
                buttons: { add: "Add", order: "Confirm Order", cart: "Cart", ordered: "Ordered" },
                messages: {
                    orderSent: "Order sent to kitchen!",
                    emptyCart: "Your cart is empty!"
                },
                cart: { title: "Cart", total: "Total", qty: "Qty" },
                ordered: { title: "Ordered Items", total: "Total", qty: "Qty" },
                table: "Table",
                confirm: {
                    clearAll: "Delete entire cart?",
                    cancel: "Cancel",
                    ok: "Delete",
                }

            },
            zh: {
                tabs: { nuong: "ÁÉ§ËÇâ", lau: "ÁÅ´ÈîÖ", mon_phu: "Â∞èËèú", nuoc: "È•ÆÊñô" },
                buttons: { add: "Ê∑ªÂä†", order: "Á¢∫Ë™çË®ÇÂñÆ", cart: "Ë¥≠Áâ©ËΩ¶", ordered: "Â∑≤ÁÇπËèú" },
                messages: {
                    orderSent: "ËÆ¢ÂçïÂ∑≤ÂèëÈÄÅÂà∞Âé®ÊàøÔºÅ",
                    emptyCart: "Ë≥ºÁâ©ËªäÊòØÁ©∫ÁöÑÔºÅ"
                },
                cart: { title: "Ë¥≠Áâ©ËΩ¶", total: "ÊÄªËÆ°", qty: "Êï∞Èáè" },
                ordered: { title: "Â∑≤ÁÇπËèúÂìÅ", total: "ÊÄªËÆ°", qty: "Êï∞Èáè" },
                table: "Ê°å",
                confirm: {
                    clearAll: "Âà™Èô§Êï¥ÂÄãË≥ºÁâ©ËªäÔºü",
                    cancel: "ÂèñÊ∂à",
                    ok: "Êì¶Èô§"
                }

            },
            ja: {
                tabs: { nuong: "ÁÑºËÇâ", lau: "Èçã", mon_phu: "„Çµ„Ç§„Éâ", nuoc: "„Éâ„É™„É≥„ÇØ" },
                buttons: { add: "ËøΩÂä†", order: "Ê≥®Êñá„ÇíÁ¢∫Ë™ç„Åô„Çã", cart: "„Ç´„Éº„Éà", ordered: "Ê≥®ÊñáÊ∏à„Åø" },
                messages: {
                    orderSent: "Ê≥®Êñá„ÅåÈÄÅ‰ø°„Åï„Çå„Åæ„Åó„ÅüÔºÅ",
                    emptyCart: "„Ç´„Éº„Éà„ÅØÁ©∫„Åß„Åô!"
                },
                cart: { title: "„Ç´„Éº„Éà", total: "ÂêàË®à", qty: "Êï∞Èáè" },
                ordered: { title: "Ê≥®ÊñáÊ∏à„ÅøÊñôÁêÜ", total: "ÂêàË®à", qty: "Êï∞Èáè" },
                table: "„ÉÜ„Éº„Éñ„É´",
                confirm: {
                    clearAll: "„Ç´„Éº„ÉàÂÖ®‰Ωì„ÇíÂâäÈô§„Åó„Åæ„Åô„Åã?",
                    cancel: "„Ç≠„É£„É≥„Çª„É´",
                    ok: "Ê∂àÂéª"
                }

            },
            ko: {
                tabs: { nuong: "Íµ¨Ïù¥", lau: "Ï†ÑÍ≥®", mon_phu: "ÏÇ¨Ïù¥Îìú", nuoc: "ÏùåÎ£å" },
                buttons: { add: "Ï∂îÍ∞Ä", order: "Ï£ºÎ¨∏ÌôïÏù∏", cart: "Ïû•Î∞îÍµ¨Îãà", ordered: "Ï£ºÎ¨∏ÏôÑÎ£å" },
                messages: {
                    orderSent: "Ï£ºÎ¨∏Ïù¥ Ï†ÑÏÜ°ÎêòÏóàÏäµÎãàÎã§!",
                    emptyCart: "Ïû•Î∞îÍµ¨ÎãàÍ∞Ä ÎπÑÏñ¥ÏûàÏäµÎãàÎã§!"
                },
                cart: { title: "Ïû•Î∞îÍµ¨Îãà", total: "Ï¥ù", qty: "ÏàòÎüâ" },
                ordered: { title: "Ï£ºÎ¨∏ÏôÑÎ£å Î©îÎâ¥", total: "Ï¥ù", qty: "ÏàòÎüâ" },
                table: "ÌÖåÏù¥Î∏î",
                confirm: {
                    clearAll: "Ïû•Î∞îÍµ¨Îãà Ï†ÑÏ≤¥Î•º ÏÇ≠Ï†úÌïòÏãúÍ≤†ÏäµÎãàÍπå?",
                    cancel: "Ï∑®ÏÜå",
                    ok: "ÏÇ≠Ï†ú"
                }

            }
        };

        /* ======================= PRODUCT DATA ======================= */
        const products = {
            nuong: [
                { id: 1, name: { vi: "Ba ch·ªâ b√≤ M·ªπ", en: "US Beef Belly", zh: "ÁæéÂúãÁâõËÖπËÇâ", ja: "Á±≥ÂõΩÁâõ„Éê„É©", ko: "ÎØ∏Íµ≠ ÏÜåÍ≥†Í∏∞ Î∞∞" }, price: 139000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/food/n%C6%B0%E1%BB%9Bng/ba-chi-bo-my.jpg?raw=true" },
                { id: 2, name: { vi: "D·∫ª s∆∞·ªùn b√≤", en: "Beef Ribs", zh: "ÁâõËÇãÊéí", ja: "Áâõ„É™„Éñ", ko: "ÏÜåÍ∞àÎπÑ" }, price: 169000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/food/n%C6%B0%E1%BB%9Bng/de-suon-bo-nuong.jpg?raw=true" },
                { id: 3, name: { vi: "S∆∞·ªùn heo s·ªët m·∫≠t ong", en: "Honey Pork Ribs", zh: "ËúúÊ±ÅË±¨ËÇãÊéí", ja: "„Éè„Éã„Éº„Éù„Éº„ÇØ„É™„Éñ", ko: "ÌóàÎãà ÎèºÏßÄÍ∞àÎπÑ" }, price: 129000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/food/n%C6%B0%E1%BB%9Bng/ga-nuong.jpg?raw=true" },
                { id: 4, name: { vi: "G√† n∆∞·ªõng", en: "Grilled Chicken", zh: "ÁÉ§Èõû", ja: "„Ç∞„É™„É´„ÉÅ„Ç≠„É≥", ko: "Íµ¨Ïö¥ Îã≠Í≥†Í∏∞" }, price: 89000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/food/n%C6%B0%E1%BB%9Bng/suon-nuong-mat-ong.jpg?raw=true" }
            ],
            lau: [
                { id: 5, name: { vi: "L·∫©u kim chi", en: "Kimchi Hotpot", zh: "Ê≥°ËèúÁÅ´ÈîÖ", ja: "„Ç≠„É†„ÉÅÈçã", ko: "ÍπÄÏπòÏ†ÑÍ≥®" }, price: 199000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/food/l%E1%BA%A9u/Lau-kim-chi.png?raw=true" },
                { id: 6, name: { vi: "L·∫©u bulgogi", en: "Bulgogi Hotpot", zh: "ÁÉ§ËÇâÁÅ´ÈîÖ", ja: "„Éó„É´„Ç≥„ÇÆÈçã", ko: "Î∂àÍ≥†Í∏∞Ï†ÑÍ≥®" }, price: 249000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/food/l%E1%BA%A9u/lau-bulgogi.webp?raw=true" }
            ],
            mon_phu: [
                { id: 7, name: { vi: "Tokbokki ph√¥ mai", en: "Cheese Tokbokki", zh: "ËäùÂ£´ÁÇíÂπ¥Á≥ï", ja: "„ÉÅ„Éº„Ç∫„Éà„ÉÉ„Éù„ÉÉ„Ç≠", ko: "ÏπòÏ¶à Îñ°Î≥∂Ïù¥" }, price: 69000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/food/m%C3%B3n%20ph%E1%BB%A5/tokbokki-pho-mai.jpg?raw=true" },
                { id: 8, name: { vi: "C∆°m tr·ªôn H√†n Qu·ªëc", en: "Bibimbap", zh: "ÊãåÈ•≠", ja: "„Éì„Éì„É≥„Éê", ko: "ÎπÑÎπîÎ∞•" }, price: 59000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/food/m%C3%B3n%20ph%E1%BB%A5/com-tron-han-quoc.jpg?raw=true" },
                { id: 9, name: { vi: "Khoai t√¢y chi√™n", en: "French Fries", zh: "ËñØÊù°", ja: "„Éù„ÉÜ„Éà„Éï„É©„Ç§", ko: "Í∞êÏûêÌäÄÍπÄ" }, price: 39000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/food/m%C3%B3n%20ph%E1%BB%A5/khoai-tay-chien.webp?raw=true" }
            ],
            nuoc: [
                { id: 10, name: { vi: "Coca Cola", en: "Coca Cola", zh: "ÂèØÂè£ÂèØ‰πê", ja: "„Ç≥„Ç´„Ç≥„Éº„É©", ko: "ÏΩîÏπ¥ÏΩúÎùº" }, price: 15000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/drink/coca-cola.jpg?raw=true" },
                { id: 11, name: { vi: "Tr√† ƒë√†o", en: "Peach Tea", zh: "Ê°ÉËå∂", ja: "„Éî„Éº„ÉÅ„ÉÜ„Ç£„Éº", ko: "Î≥µÏà≠ÏïÑÏ∞®" }, price: 29000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/drink/tra-dao.jpg?raw=true" },
                { id: 12, name: { vi: "Bia", en: "Beer", zh: "Âï§ÈÖí", ja: "„Éì„Éº„É´", ko: "Îß•Ï£º" }, price: 39000, img: "https://github.com/huyhuynh03/Food_Order_At_Table/blob/main/images/drink/bia.png?raw=true" }
            ]
        };

        /* ======================= STATE ======================= */
        let cart = {};
        let currentTab = "nuong";
        let currentLang = "vi";
        let orderedItems = {}; // l∆∞u c√°c m√≥n ƒë√£ ƒë·∫∑t (icon chu√¥ng)
        let currentTableId = 1; // l∆∞u table ID t·ª´ URL


        /* ======================= RENDER MENU ======================= */
        function renderMenu() {
            const list = document.getElementById("menuList");
            list.innerHTML = "";

            products[currentTab].forEach(item => {
                if (!cart[item.id]) cart[item.id] = { ...item, qty: 0 };

                list.innerHTML += `
            <div class="card
            ${cart[item.id].qty > 0 ? "selected" : ""}
            ${orderedItems[item.id] ? "ordered-flag" : ""}
            ">

             ${cart[item.id].qty > 0 ? '<div class="tick-mark">‚úì</div>' : ""}

            <img src="${item.img}">
            <div class="card-body">
                <div style="font-size:18px;font-weight:bold;">${item.name[currentLang]}</div>
                <div class="price">${item.price.toLocaleString()} ƒë</div>

                <div class="qty-row">
                    <div class="qty-btn" onclick="changeQty(${item.id}, -1)">‚àí</div>
                    <input type="number"
                     id="qtyInput_${item.id}"
                     class="qty-input"
                     value="${cart[item.id].tempQty ?? cart[item.id].qty}"
                     min="0"
                     oninput="updateTempQty(${item.id}, this.value)">

                    <div class="qty-btn" onclick="changeQty(${item.id}, 1)">+</div>
                    <div class="add-cart-btn" onclick="addToCart(${item.id})">
                        ${translations[currentLang].buttons.add}
                    </div>
                </div>
            </div>
        </div>`;
            });
        }
        /* ======================= TAB ======================= */
        function changeTab(tab, event) {
            currentTab = tab;
            document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
            event.target.classList.add("active");
            renderMenu();
        }

        /* ======================= QTY ======================= */
        function changeQty(id, val) {
            if (!cart[id].tempQty) cart[id].tempQty = 0;

            cart[id].tempQty = Math.max(0, Number(cart[id].tempQty) + val);

            const num = cart[id].tempQty;
            document.getElementById(`qtyInput_${id}`).value = num;

            // üî• N·∫øu m√≥n ƒë√£ trong gi·ªè ‚Üí c·∫≠p nh·∫≠t gi·ªè ngay
            if (cart[id].qty > 0) {

                if (num === 0) {
                    cart[id].qty = 0;
                    updateCart();
                    renderMenu();
                    return;
                }

                cart[id].qty = num;
                updateCart();
                renderCartItems();
            }

            renderMenu();
        }


        function updateTempQty(id, value) {
            // Cho ph√©p xo√° h·∫øt ƒë·ªÉ g√µ l·∫°i m√† kh√¥ng b·ªã reset
            if (value === "") {
                cart[id].tempQty = 0;
                return;
            }

            let num = Number(value);
            if (isNaN(num)) return;

            num = Math.max(0, num);
            cart[id].tempQty = num;

            // N·∫øu m√≥n n√†y ƒë√£ n·∫±m trong gi·ªè th√¨ c·∫≠p nh·∫≠t lu√¥n SL th·∫≠t + t·ªïng ti·ªÅn
            if (cart[id].qty > 0) {
                if (num === 0) {
                    cart[id].qty = 0;
                    updateCart();   // ch·ªâ c·∫≠p nh·∫≠t gi·ªè, KH√îNG render l·∫°i menu
                    renderMenu();   // üî• th√™m d√≤ng n√†y ƒë·ªÉ g·ª° tick ngay l·∫≠p t·ª©c
                    return;
                }

                cart[id].qty = num;
                updateCart();       // c·∫≠p nh·∫≠t t·ªïng + danh s√°ch trong gi·ªè
            }
        }




        /* ======================= ADD TO CART ======================= */
        function addToCart(id) {
            const temp = Number(cart[id].tempQty || 0);

            if (temp > 0) {
                cart[id].qty = temp;  // C·∫¨P NH·∫¨T GI·ªé
                updateCart();
                renderMenu();

            }

            // Animation rung
            const el = document.getElementById("cartCount");
            el.style.animation = "shake 0.4s";
            setTimeout(() => el.style.animation = "", 400);
        }

        /* ======================= UPDATE CART ======================= */
        function updateCart() {
            let total = 0, count = 0;

            for (let id in cart) {
                if (cart[id].qty > 0) {
                    total += cart[id].qty * cart[id].price;
                    count += cart[id].qty;
                }
            }

            // total ordered
            let orderedTotal = 0;
            for (let id in orderedItems) {
                orderedTotal += orderedItems[id].qty * orderedItems[id].price;
            }

            // total final
            document.getElementById("totalPrice").innerText =
                (total + orderedTotal).toLocaleString();


            document.getElementById("totalPrice").innerText = total.toLocaleString();
            document.getElementById("cartCount").innerText = count;
            renderCartItems();
        }

        /* ======================= CART ITEMS ======================= */
        function renderCartItems() {
            const box = document.getElementById("cartItems");
            box.innerHTML = "";

            for (let id in cart) {
                if (cart[id].qty > 0) {
                    box.innerHTML += `
<div class="cart-item">
    <b>${cart[id].name[currentLang]}</b><br>

    ${translations[currentLang].cart.qty}:
      <input class="cartQtyInput"
        type="number"
        value="${cart[id].qty}"
        min="0"
        data-id="${id}"
        onkeydown="if (event.key === 'Enter') changeCartQty(this)">


    √ó ${cart[id].price.toLocaleString()} ƒë

    <span class="cart-item-delete" onclick="deleteItem(${id})">üóëÔ∏è</span>
</div>`;


                }
            }
        }

        /* ======================= CART PANEL ======================= */



        function toggleCart() {
            document.getElementById("cartPanel").classList.toggle("show");
        }

        function toggleOrdered() {
            document.getElementById("orderedPanel").classList.toggle("show");
        }


        /* ======================= ORDER ======================= */
        function placeOrder() {
            let hasItems = false;
            let itemsToOrder = [];

            for (let id in cart) {
                if (cart[id].qty > 0) {
                    hasItems = true;
                    itemsToOrder.push({
                        id: id,
                        name: cart[id].name, // L∆∞u c·∫£ object t√™n ƒëa ng√¥n ng·ªØ
                        price: cart[id].price,
                        qty: cart[id].qty
                    });
                }
            }

            if (!hasItems) {
                showAlert(translations[currentLang].messages.emptyCart);
                return;
            }

            // L·∫•y b√†n t·ª´ URL parameter
            const tableIndex = currentTableId;
            const tableId = `table_${tableIndex}`;

            // G·ª≠i l√™n Firebase
            const tableRef = db.collection("tables").doc(tableId);

            // D√πng arrayUnion ƒë·ªÉ th√™m m√≥n m·ªõi v√†o m·∫£ng orders hi·ªán c√≥
            // L∆∞u √Ω: arrayUnion ch·ªâ th√™m n·∫øu ch∆∞a t·ªìn t·∫°i (unique), nh∆∞ng ·ªü ƒë√¢y m·ªói l·∫ßn ƒë·∫∑t l√† 1 ƒë·ª£t kh√°c nhau?
            // N·∫øu user ƒë·∫∑t m√≥n gi·ªëng h·ªát (id, qty) th√¨ arrayUnion c√≥ th·ªÉ l·ªçc b·ªè.
            // Tuy nhi√™n, logic ƒë∆°n gi·∫£n nh·∫•t l√† c·ª© push v√†o.
            // Nh∆∞ng Firestore arrayUnion so s√°nh deep equality.
            // ƒê·ªÉ an to√†n v√† ƒë∆°n gi·∫£n cho b√†i to√°n n√†y, ta s·∫Ω ƒë·ªçc v·ªÅ r·ªìi update, ho·∫∑c d√πng arrayUnion n·∫øu ch·∫•p nh·∫≠n r·ªßi ro tr√πng.
            // T·ªët nh·∫•t l√† ƒë·ªçc v·ªÅ r·ªìi push th√™m v√†o m·∫£ng.

            // Tuy nhi√™n, ƒë·ªÉ t·ªëi ∆∞u UX (kh√¥ng ch·ªù m·∫°ng qu√° l√¢u), ta c√≥ th·ªÉ update optimistic UI tr∆∞·ªõc.

            // C·∫≠p nh·∫≠t UI local (nh∆∞ c≈©)
            for (let id in cart) {
                if (cart[id].qty > 0) {
                    if (!orderedItems[id]) {
                        orderedItems[id] = { ...cart[id] };
                    } else {
                        orderedItems[id].qty += cart[id].qty;
                    }
                    cart[id].qty = 0;
                    cart[id].tempQty = 0;
                }
            }

            updateCart();
            renderMenu();
            renderOrderedItems();
            showAlert(translations[currentLang].messages.orderSent);

            // G·ª≠i background l√™n Firebase
            tableRef.get().then((doc) => {
                let currentOrders = [];
                if (doc.exists) {
                    currentOrders = doc.data().orders || [];
                }

                // N·ªëi th√™m m√≥n m·ªõi
                const newOrders = currentOrders.concat(itemsToOrder);

                // Update l·∫°i
                // C·∫ßn set c·∫£ name cho b√†n n·∫øu ch∆∞a c√≥?
                // "B√†n X"
                return tableRef.set({
                    name: `B√†n ${tableIndex}`,
                    orders: newOrders,
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
            }).catch((error) => {
                console.error("Error writing document: ", error);
                showAlert("L·ªói k·∫øt n·ªëi Firebase!");
            });
        }



        /* ======================= LANGUAGE SWITCH ======================= */
        document.getElementById("langSelect").addEventListener("change", function () {

            document.getElementById("confirmCancelBtn").innerText = translations[currentLang].confirm.cancel;
            document.getElementById("confirmOkBtn").innerText = translations[currentLang].confirm.ok;


            currentLang = {
                "Ti·∫øng Vi·ªát": "vi", "English": "en", "‰∏≠Êñá": "zh", "Êó•Êú¨Ë™û": "ja", "ÌïúÍµ≠Ïñ¥": "ko"
            }[this.value];

            // Update tab text
            document.querySelectorAll(".tab").forEach(tab => {
                const key = tab.getAttribute("onclick").match(/'(\w+)'/)[1];
                tab.innerText = translations[currentLang].tabs[key];
            });

            // Buttons
            document.getElementById("orderBtn").innerText = translations[currentLang].buttons.order;
            document.getElementById("cartBtnText").innerText = translations[currentLang].buttons.cart;
            document.getElementById("orderedText").innerText = translations[currentLang].buttons.ordered;

            // Cart text
            document.getElementById("cartTitle").innerText = translations[currentLang].cart.title;
            document.getElementById("totalLabel").innerText = translations[currentLang].cart.total;

            // Ordered panel text
            document.getElementById("orderedTitle").innerText = translations[currentLang].ordered.title;
            document.getElementById("orderedTotalLabel").innerText = translations[currentLang].ordered.total;

            // Update table display text with current language
            const tableDisplay = document.getElementById("tableDisplay");
            tableDisplay.innerText = `${translations[currentLang].table} ${currentTableId}`;

            // ‚¨ÖÔ∏è FIX: Re-render menu + cart + ordered items theo ng√¥n ng·ªØ m·ªõi
            renderMenu();
            updateCart();
            renderOrderedItems();
        });

        /* ======================= URL PARAMETER HANDLING ======================= */
        // L·∫•y table ID t·ª´ URL parameter (v√≠ d·ª•: ?table=3)
        function getTableIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            const tableParam = urlParams.get('table');

            if (tableParam) {
                const tableNum = parseInt(tableParam);
                // Validate table number (1-10)
                if (tableNum >= 1 && tableNum <= 10) {
                    return tableNum;
                }
            }

            // Default to table 1 if no valid parameter
            return 1;
        }

        /* INIT */
        // L·∫•y table ID t·ª´ URL v√† c·∫≠p nh·∫≠t hi·ªÉn th·ªã
        currentTableId = getTableIdFromUrl();
        document.getElementById("tableDisplay").innerText = `${translations[currentLang].table} ${currentTableId}`;
        renderMenu();
    </script>


    <div id="customAlertOverlay">
        <div id="customAlertBox">
            <div id="alertMessage">Th√¥ng b√°o</div>
            <div id="alertOkBtn" onclick="closeAlert()">OK</div>
        </div>
    </div>


    <div id="customConfirmOverlay">
        <div id="customConfirmBox">
            <div id="confirmMessage">B·∫°n c√≥ ch·∫Øc?</div>

            <div class="confirm-buttons">
                <div id="confirmCancelBtn" class="confirm-btn" onclick="closeConfirm(false)">H·ªßy</div>
                <div id="confirmOkBtn" class="confirm-btn" onclick="closeConfirm(true)">X√≥a</div>
            </div>
        </div>
    </div>


</body>

</html>
